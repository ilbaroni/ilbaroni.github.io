---
layout: post
title:  "EPSILON ransomware"
date:   2021-01-28
categories: reversing
---
# Introduction

This ransomware is written in .NET and uses AES in CBC followed by RC4 to encrypt the files meaning it will encrypt the files twice.

# Overview of the ransomware

It starts by setting up persistence using a run key:

![persistence](/assets/images/epsilon/img-persistence.PNG)

Next it starts the encryption of files using AES and RC4:

![encrypt](/assets/images/epsilon/img-encrypt.PNG)

The ransomware targets the following drives:

```
C:, D:, E:, F:, G:, Z:, A:
```

And encrypts files with the following extensions:

```
.txt, .doc, .docx, .xls, .index, .pdf, .zip, .rar, .css, .lnk, .xlsx, .ppt, .pptx, .odt, .jpg, .bmp, .png, .csv, .sql, .mdb, .sln, .php, .asp, .aspx, .html, .xml, .psd, .bk, .bat, .mp3, .mp4, .wav, .wma, .avi, .divx, .mkv, .mpeg, .wmv, .mov, .ogg, .rtf
```

The encrypted files are given the following extension:

```
.[neftet@tutanota.com].boom
```

The keys used for AES and RC4 are generated by a function that is very similar to the CobraLocker key generation function (that I posted before [here](http://blog.reversing.xyz/cobralocker.html)).

![passgen](/assets/images/epsilon/img-passgen.PNG)

After the file encryption, the ransomware downloads to the startup folder a BMP image from the following discord cdn link:

```
hxxps://cdn.discordapp.com/attachments/599226424695455755/800087465523675176/65QEF.bmp
```

The ransomnote also comes from discord cdn in the form of an HTA file:

```
hxxps://cdn.discordapp.com/attachments/599226424695455755/798932401216552974/READ_ME.hta
```

Saving the HTA file to the startup folder:

![ransomnote](/assets/images/epsilon/img-ransomnote.PNG)

Ransomnote displayed via mshta.exe:

```
"C:\Windows\SysWOW64\mshta.exe" "C:\Users\Admin\Desktop\READ_ME.hta" 
```

![note](/assets/images/epsilon/image-20210128111620299.png)

To finish the ransomware deletes the Windows recovery files using the following commands:

```
cmd.exe /C vssadmin.exe delete shadows /all /quiet
cmd.exe /C wmic shadowcopy delete
cmd.exe /C wbadmin delete catalog -quiet
```

# IOCs

```
SHA256

6b2affdfb3fe673b22ba6108fc78986ffea8167c5f3a80834e48378659d0ea83

Email

EpsilonCrypt@tutanota[.]com
```
